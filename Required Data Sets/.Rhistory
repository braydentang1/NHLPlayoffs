data = schedule_and_results %>%
html_nodes("#games .right:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Home = .)
data = schedule_and_results %>%
html_nodes("#games td.center") %>%
html_text(.) %>%
bind_cols(data, SOorOTIndicator = .) %>%
mutate(Outcome.Home = ifelse(SOorOTIndicator == "SO", 0.5,
ifelse(Goals_Home > Goals_Visitor, 1,0))) %>%
filter(.,!is.na(Goals_Visitor))
constant = ifelse(last.games == 0, 1, nrow(data)-last.games)
for (i in constant:nrow(data)){
visitorELO = trackELO$ELORating[which(trackELO$Team == data$Visitor[i])]
homeELO = trackELO$ELORating[which(trackELO$Team == data$Home[i])]
goal.difference = data$Goals_Home[i] - data$Goals_Visitor[i]
ELOChange = 8 * 1 * calculateM(goal.difference_home = goal.difference, ELO_Home = homeELO, ELO_Visitor = visitorELO) * (data$Outcome.Home[i] - calculateEH(ELO_Home = homeELO, ELO_Visitor = visitorELO))
if(is.na(ELOChange)){
paste("Iteration:", i, sep = " ")
}
trackELO$ELORating[which(trackELO$Team == data$Visitor[i])] = visitorELO + -ELOChange
trackELO$ELORating[which(trackELO$Team == data$Home[i])] = homeELO + ELOChange
}
rm(i)
out = trackELO
}
abc = getData(2019)
abc = getData(2019) %>% arrange(. -ELORating)
abc = getData(2019) %>% arrange(., -ELORating)
View(abc)
library(tidyverse)
library(rvest)
template = read_csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv") %>%
mutate(Team1 = ifelse(Team1 == "St Louis Blues", "St. Louis Blues", Team1)) %>%
mutate(Team2 = ifelse(Team2 == "St Louis Blues", "St. Louis Blues", Team2)) %>%
mutate(Highest.Seed = ifelse(Highest.Seed == "St Louis Blues", "St. Louis Blues", Highest.Seed))
accronyms_pg = read_html("https://en.wikipedia.org/wiki/Template:NHL_team_abbreviations")
accronyms = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 1,3)
fullnames = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 7, 1000000L)
lookup_Accronyms = cbind(FullName = fullnames, Accronym = accronyms) %>% as_tibble(.) %>% bind_rows(., c(FullName = "Mighty Ducks of Anaheim", Accronym = "MDA")) %>% bind_rows(., c(FullName = "St Louis Blues", Accronym = "STL"))
lookup_Accronyms$Accronym = ifelse(lookup_Accronyms$Accronym == "VGK", "VEG", lookup_Accronyms$Accronym)
rm(accronyms_pg, accronyms, fullnames)
#The function below uses the formula given by http://hockeyanalytics.com/2016/07/elo-ratings-for-the-nhl/ to actually calculate ELO ratings. This is quite complex and so refer
#to the page for actual details.
calculateM = function(goal.difference_home, ELO_Home, ELO_Visitor){
M = max(1,log(abs(goal.difference_home-0.0085*(ELO_Home - ELO_Visitor + 35)) + exp(1) -1))
ifelse(is.na(M), stop(paste("List of Parameters:",goal.difference_home, ELO_Home, ELO_Visitor, sep = " ")), M)
}
calculateEH = function(ELO_Home, ELO_Visitor){
EH = 1/(1 + 10^(-(ELO_Home - ELO_Visitor + 35) / 400))
ifelse(is.na(EH), stop("NA"), EH)
}
getData = function(year, last.games = 0){
teamnames = read_html(paste("https://www.hockey-reference.com/leagues/NHL_",year,"_standings.html", sep="")) %>%
html_nodes("#standings td.left") %>%
html_text(.)
trackELO = tibble(Team = teamnames) %>%
bind_cols(., ELORating = rep(1500, nrow(.)), Year = rep(year, nrow(.)))
rm(teamnames)
schedule_and_results = read_html(paste("https://www.hockey-reference.com/leagues/NHL_",year,"_games.html", sep=""))
visitor = schedule_and_results %>%
html_nodes("#games .left+ td.left") %>%
html_text(.)
data  = schedule_and_results %>%
html_nodes("#games td:nth-child(4)") %>%
html_text(.) %>%
bind_cols(Visitor = visitor, Home = .)
rm(visitor)
data = schedule_and_results %>%
html_nodes("#games .right:nth-child(3)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Visitor = .)
data = schedule_and_results %>%
html_nodes("#games .right:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Home = .)
data = schedule_and_results %>%
html_nodes("#games td.center") %>%
html_text(.) %>%
bind_cols(data, SOorOTIndicator = .) %>%
mutate(Outcome.Home = ifelse(SOorOTIndicator == "SO", 0.5,
ifelse(Goals_Home > Goals_Visitor, 1,0))) %>%
filter(.,!is.na(Goals_Visitor))
constant = ifelse(last.games == 0, 1, nrow(data)-last.games)
for (i in constant:nrow(data)){
visitorELO = trackELO$ELORating[which(trackELO$Team == data$Visitor[i])]
homeELO = trackELO$ELORating[which(trackELO$Team == data$Home[i])]
goal.difference = data$Goals_Home[i] - data$Goals_Visitor[i]
ELOChange = 8 * 1 * calculateM(goal.difference_home = goal.difference, ELO_Home = homeELO, ELO_Visitor = visitorELO) * (data$Outcome.Home[i] - calculateEH(ELO_Home = homeELO, ELO_Visitor = visitorELO))
if(is.na(ELOChange)){
paste("Iteration:", i, sep = " ")
}
trackELO$ELORating[which(trackELO$Team == data$Visitor[i])] = visitorELO + -ELOChange
trackELO$ELORating[which(trackELO$Team == data$Home[i])] = homeELO + ELOChange
}
rm(i)
out = trackELO
}
abc = getData(2019)
View(abc)
abc = getData(2019) %>% arrange(., -ELORating)
{
teamnames = read_html(paste("https://www.hockey-reference.com/leagues/NHL_",year,"_standings.html", sep="")) %>%
html_nodes("#standings td.left") %>%
html_text(.)
trackELO = tibble(Team = teamnames) %>%
bind_cols(., ELORating = rep(1500, nrow(.)), Year = rep(year, nrow(.)))
rm(teamnames)
schedule_and_results = read_html(paste("https://www.hockey-reference.com/leagues/NHL_",year,"_games.html", sep=""))
visitor = schedule_and_results %>%
html_nodes("#games .left+ td.left") %>%
html_text(.)
data  = schedule_and_results %>%
html_nodes("#games td:nth-child(4)") %>%
html_text(.) %>%
bind_cols(Visitor = visitor, Home = .)
rm(visitor)
data = schedule_and_results %>%
html_nodes("#games .right:nth-child(3)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Visitor = .)
data = schedule_and_results %>%
html_nodes("#games .right:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Home = .)
data = schedule_and_results %>%
html_nodes("#games td.center") %>%
html_text(.) %>%
bind_cols(data, SOorOTIndicator = .) %>%
mutate(Outcome.Home = ifelse(SOorOTIndicator == "SO", 0.5,
ifelse(Goals_Home > Goals_Visitor, 1,0))) %>%
filter(.,!is.na(Goals_Visitor))
constant = ifelse(last.games == 0, 1, nrow(data)-last.games)
for (i in constant:nrow(data)){
visitorELO = trackELO$ELORating[which(trackELO$Team == data$Visitor[i])]
homeELO = trackELO$ELORating[which(trackELO$Team == data$Home[i])]
goal.difference = data$Goals_Home[i] - data$Goals_Visitor[i]
ELOChange = 8 * 1 * calculateM(goal.difference_home = goal.difference, ELO_Home = homeELO, ELO_Visitor = visitorELO) * (data$Outcome.Home[i] - calculateEH(ELO_Home = homeELO, ELO_Visitor = visitorELO))
if(is.na(ELOChange)){
paste("Iteration:", i, sep = " ")
}
trackELO$ELORating[which(trackELO$Team == data$Visitor[i])] = visitorELO + -ELOChange
trackELO$ELORating[which(trackELO$Team == data$Home[i])] = homeELO + ELOChange
}
rm(i)
out = trackELO
}
library(tidyverse)
library(rvest)
template = read_csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv") %>%
mutate(Team1 = ifelse(Team1 == "St Louis Blues", "St. Louis Blues", Team1)) %>%
mutate(Team2 = ifelse(Team2 == "St Louis Blues", "St. Louis Blues", Team2)) %>%
mutate(Highest.Seed = ifelse(Highest.Seed == "St Louis Blues", "St. Louis Blues", Highest.Seed))
accronyms_pg = read_html("https://en.wikipedia.org/wiki/Template:NHL_team_abbreviations")
accronyms = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 1,3)
fullnames = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 7, 1000000L)
lookup_Accronyms = cbind(FullName = fullnames, Accronym = accronyms) %>% as_tibble(.) %>% bind_rows(., c(FullName = "Mighty Ducks of Anaheim", Accronym = "MDA")) %>% bind_rows(., c(FullName = "St Louis Blues", Accronym = "STL"))
lookup_Accronyms$Accronym = ifelse(lookup_Accronyms$Accronym == "VGK", "VEG", lookup_Accronyms$Accronym)
rm(accronyms_pg, accronyms, fullnames)
#The function below uses the formula given by http://hockeyanalytics.com/2016/07/elo-ratings-for-the-nhl/ to actually calculate ELO ratings. This is quite complex and so refer
#to the page for actual details.
calculateM = function(goal.difference_home, ELO_Home, ELO_Visitor){
M = max(1,log(abs(goal.difference_home-0.0085*(ELO_Home - ELO_Visitor + 35)) + exp(1) -1))
ifelse(is.na(M), stop(paste("List of Parameters:",goal.difference_home, ELO_Home, ELO_Visitor, sep = " ")), M)
}
calculateEH = function(ELO_Home, ELO_Visitor){
EH = 1/(1 + 10^(-(ELO_Home - ELO_Visitor + 35) / 400))
ifelse(is.na(EH), stop("NA"), EH)
}
getData = function(year, last.games = 0){
teamnames = read_html(paste("https://www.hockey-reference.com/leagues/NHL_",year,"_standings.html", sep="")) %>%
html_nodes("#standings td.left") %>%
html_text(.)
trackELO = tibble(Team = teamnames) %>%
bind_cols(., ELORating = rep(1500, nrow(.)), Year = rep(year, nrow(.)))
rm(teamnames)
schedule_and_results = read_html(paste("https://www.hockey-reference.com/leagues/NHL_",year,"_games.html", sep=""))
visitor = schedule_and_results %>%
html_nodes("#games .left+ td.left") %>%
html_text(.)
data  = schedule_and_results %>%
html_nodes("#games td:nth-child(4)") %>%
html_text(.) %>%
bind_cols(Visitor = visitor, Home = .)
rm(visitor)
data = schedule_and_results %>%
html_nodes("#games .right:nth-child(3)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Visitor = .)
data = schedule_and_results %>%
html_nodes("#games .right:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.) %>%
bind_cols(data, Goals_Home = .)
data = schedule_and_results %>%
html_nodes("#games td.center") %>%
html_text(.) %>%
bind_cols(data, SOorOTIndicator = .) %>%
mutate(Outcome.Home = ifelse(SOorOTIndicator == "SO", 0.5,
ifelse(Goals_Home > Goals_Visitor, 1,0))) %>%
filter(.,!is.na(Goals_Visitor))
constant = ifelse(last.games == 0, 1, nrow(data)-last.games)
for (i in constant:nrow(data)){
visitorELO = trackELO$ELORating[which(trackELO$Team == data$Visitor[i])]
homeELO = trackELO$ELORating[which(trackELO$Team == data$Home[i])]
goal.difference = data$Goals_Home[i] - data$Goals_Visitor[i]
ELOChange = 8 * 1 * calculateM(goal.difference_home = goal.difference, ELO_Home = homeELO, ELO_Visitor = visitorELO) * (data$Outcome.Home[i] - calculateEH(ELO_Home = homeELO, ELO_Visitor = visitorELO))
if(is.na(ELOChange)){
paste("Iteration:", i, sep = " ")
}
trackELO$ELORating[which(trackELO$Team == data$Visitor[i])] = visitorELO + -ELOChange
trackELO$ELORating[which(trackELO$Team == data$Home[i])] = homeELO + ELOChange
}
rm(i)
out = trackELO
}
abc = getData(2019) %>% arrange(., -ELORating)
abc
View(abc)
library(tidyverse)
library(rvest)
template = read_csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv") %>%
mutate_all(funs(str_replace(., "Mighty Ducks of Anaheim", "Anaheim Ducks"))) %>%
mutate_all(funs(str_replace(., "Phoenix Coyotes", "Arizona Coyotes")))
accronyms_pg = read_html("https://en.wikipedia.org/wiki/Template:NHL_team_abbreviations")
accronyms = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 1,3)
fullnames = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 7, 1000000L)
lookup_Accronyms = cbind(FullName = fullnames, Team = accronyms) %>%
as_tibble(.) %>%
bind_rows(., c(FullName = "Mighty Ducks of Anaheim", Team = "MDA"))
rm(accronyms_pg, accronyms, fullnames)
getData = function(year){
data = read_csv(paste("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Game Score/", year, ".csv", sep=""), na = "--") %>%
.[,2:ncol(.)] %>%
mutate(TradedPlayer = ifelse(grepl("/", Team) == TRUE, 1,0)) %>%
mutate(Team = gsub(" ", "", Team, fixed = TRUE)) %>%
mutate_if(is.numeric, funs(ifelse(is.infinite(.), 0,.))) %>%
mutate_if(is.numeric, funs(ifelse(is.na(.), 0,.))) %>%
mutate_if(is.numeric, funs(ifelse(is.nan(.),0,.))) %>%
select(., -Position, -Season)
AllTradedPlayers = data[data$TradedPlayer == 1,]
AllTradedPlayers_Team1 = AllTradedPlayers %>% mutate(Team = sub("/.*", "", AllTradedPlayers$Team))
AllTradedPlayers_Team2 = AllTradedPlayers %>% mutate(Team = sub(".*/", "", AllTradedPlayers$Team))
AllTradedPlayers_Team3 = AllTradedPlayers %>% mutate(Team = sub(".*/ *(.*?) */.*", "\\1", AllTradedPlayers$Team))
AllTradedPlayers_Team3 = AllTradedPlayers_Team3[-which(grepl("/", AllTradedPlayers_Team3$Team) == TRUE), ]
combined = rbind(AllTradedPlayers_Team1, AllTradedPlayers_Team2, AllTradedPlayers_Team3)
rm(list = ls(pattern = "AllTradedPlayers"))
data = bind_rows(data[-which(data$TradedPlayer == 1),], combined)
rm(combined)
data$Team = as.factor(data$Team)
#removed "GS", "CF.", "Rel.CF." since they are already included in Full Data
data = data %>%
mutate(GS = GS/TOI) %>%
mutate(P1 = P1/TOI) %>%
mutate(CF = CF/TOI) %>%
rename(iPDO = PDO) %>%
group_by(Team) %>%
summarise_at(funs(mean(., na.rm = TRUE), sd(., na.rm=TRUE), min(.,na.rm=TRUE), max(., na.rm=TRUE)), .vars = c("iCF/60", "P1", "P1/60", "GS", "GS/60", "CF", "Rel CF%",
"ixGF/60", "ZSR", "CF% QoT", "CF% QoC", "TOI% QoT", "TOI% QoC", "iPDO")) %>%
mutate(Team = as.character(Team))
bind_cols(data, tibble(Year = rep(year, nrow(data))))
}
allCombined = bind_rows(lapply(2008:2018, getData)) %>%
mutate(Team = ifelse(Team == "L.A", "LAK", Team)) %>%
mutate(Team = ifelse(Team == "N.J", "NJD", Team)) %>%
mutate(Team = ifelse(Team == "S.J", "SJS", Team)) %>%
mutate(Team = ifelse(Team == "T.B", "TBL", Team))
findMatch = function(team.1, team.2, stat, data, highest.seed){
data = data %>%
left_join(., lookup_Accronyms, by = "Team") %>%
mutate(FullName = ifelse(FullName == "St. Louis Blues", "St Louis Blues", FullName))
tmp = unlist(c(data[, names(data) %in% c(stat)][which(data$FullName == team.1),], data[, names(data) %in% c(stat)][which(data$FullName == team.2),]))
tmp[which(c(team.1, team.2) == highest.seed)] - tmp[which(c(team.1, team.2) != highest.seed)]
}
processData = function(team.1, team.2, highest.seed, data, year){
data = data %>%
filter(., Year == year)
team_vec = as_tibble(unlist(lapply(colnames(data)[2:(ncol(data)-1)], FUN = findMatch, team.1 = team.1, team.2 = team.2, data = data, highest.seed = highest.seed))) %>%
rownames_to_column(.) %>%
spread(rowname, value)
colnames(team_vec) = colnames(data)[2:(ncol(data)-1)]
team_vec
}
View(allCombined)
final = bind_rows(mapply(FUN = processData, team.1 = template$Team1, team.2 = template$Team2, highest.seed = template$Highest.Seed, year = template$Year, MoreArgs = list(data = allCombined), SIMPLIFY = FALSE))
View(final)
View(allCombined)
moments::skewness(final$ZSR_min, na.rm= TRUE)
year = 2013
year2 = year - 1
mainpage = read_html(paste("https://www.naturalstattrick.com/teamtable.php?fromseason=",year2,year,"&thruseason=",year2,year,"&stype=2&sit=5v5&score=all&rate=n&team=all&loc=B&gpf=410&fd=&td=", sep=""))
teams = mainpage %>%
html_nodes(".lh") %>%
html_text(.) %>%
.[2:length(.)]
SCF = mainpage %>%
html_nodes("td:nth-child(25)") %>%
html_text(.) %>%
as.numeric(.)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.)
library(tidyverse)
library(rvest)
template = read.csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv", na.strings = FALSE, stringsAsFactors = FALSE)
year2 = year - 1
mainpage = read_html(paste("https://www.naturalstattrick.com/teamtable.php?fromseason=",year2,year,"&thruseason=",year2,year,"&stype=2&sit=5v5&score=all&rate=n&team=all&loc=B&gpf=410&fd=&td=", sep=""))
teams = mainpage %>%
html_nodes(".lh") %>%
html_text(.) %>%
.[2:length(.)]
SCF = mainpage %>%
html_nodes("td:nth-child(25)") %>%
html_text(.) %>%
as.numeric(.)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.)
year2 = year - 1
mainpage = read_html(paste("https://www.naturalstattrick.com/teamtable.php?fromseason=",year2,year,"&thruseason=",year2,year,"&stype=2&sit=5v5&score=all&rate=n&team=all&loc=B&gpf=410&fd=&td=", sep=""))
teams = mainpage %>%
html_nodes(".lh") %>%
html_text(.) %>%
.[2:length(.)]
SCF = mainpage %>%
html_nodes("td:nth-child(25)") %>%
html_text(.) %>%
as.numeric(.)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.) %>%
case_when(year == 2013 ~ ./48, year != 2013 ~ ./82)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.) %>%
case_when(year == 2013 ~ SCA/48, year != 2013 ~ SCA/82)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.) %>%
.[.]/82
SCA
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.)
SCA = if(year == 2013){
SCA = SCA/48
}else{
SCA = SCA/82
}
HighDangerSC_Percent = mainpage %>%
html_nodes("td:nth-child(33)") %>%
html_text(.) %>%
as.numeric(.)
HDCA = mainpage %>%
html_nodes("td:nth-child(35)") %>%
html_text(.) %>%
as.numeric(.)
year2 = year - 1
mainpage = read_html(paste("https://www.naturalstattrick.com/teamtable.php?fromseason=",year2,year,"&thruseason=",year2,year,"&stype=2&sit=5v5&score=all&rate=n&team=all&loc=B&gpf=410&fd=&td=", sep=""))
teams = mainpage %>%
html_nodes(".lh") %>%
html_text(.) %>%
.[2:length(.)]
SCF = mainpage %>%
html_nodes("td:nth-child(25)") %>%
html_text(.) %>%
as.numeric(.)
SCA = mainpage %>%
html_nodes("td:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.)
HighDangerSC_Percent = mainpage %>%
html_nodes("td:nth-child(33)") %>%
html_text(.) %>%
as.numeric(.)
HDCA = mainpage %>%
html_nodes("td:nth-child(35)") %>%
html_text(.) %>%
as.numeric(.)
if(year == 2013){
SCA = SCA/48
HDCA = HDCA/48
}else{
SCA = SCA/82
HDCA = HDCA/82
}
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/NaturalStatTrick.R', echo=TRUE)
View(final)
View(final)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/CorsicaGameScore.R', echo=TRUE)
View(final)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/NHL Official.R', echo=TRUE)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/NHL Official.R', echo=TRUE)
year = 2013
library(tidyverse)
library(rvest)
template = read_csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv")
accronyms_pg = read_html("https://en.wikipedia.org/wiki/Template:NHL_team_abbreviations")
accronyms = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 1,3)
fullnames = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 7, 1000000L)
lookup_Accronyms = cbind(FullName = fullnames, Accronym = accronyms) %>%
as_tibble(.) %>%
bind_rows(., c(FullName = "Mighty Ducks of Anaheim", Accronym = "MDA"))
rm(accronyms_pg, accronyms, fullnames)
year2 = year - 1
mainpage = read_html(paste("http://www.puckon.net/fenwick.php?s=",year2,"-09-01&e=",year,"-06-30&f=0&ld=1&l=82&p=0", sep=""))
last20page_main = read_html(paste("https://www.puckon.net/?s=",year2,"-08-01&e=",year,"-06-30&f=0&ld=-1&l=20&p=0", sep = ""))
last20page_Goals = read_html(paste("https://www.puckon.net/goals.php?f=0&s=",year2,"-08-01&e=",year,"-06-30&l=-20&p=0", sep=""))
last20page_misses = read_html(paste("https://www.puckon.net/misses.php?f=0&s=",year2,"-08-01&e=",year,"-06-30&l=-20&p=0", sep=""))
last20page_blocks = read_html(paste("https://www.puckon.net/blocks.php?f=0&s=",year2,"-08-01&e=",year,"-06-30&l=-20&p=0", sep=""))
last20page_hits = read_html(paste("https://www.puckon.net/hits.php?f=0&s=",year2,"-08-01&e=",year,"-06-30&l=-20&p=0", sep=""))
teams = mainpage %>%
html_nodes("td:nth-child(1)") %>%
html_text(.) %>%
gsub("\\.", "",.) %>%
as_tibble(.) %>%
set_names(., "Accronym") %>%
mutate(Accronym = ifelse(Accronym == "LA", "LAK",Accronym)) %>%
mutate(Accronym = ifelse(Accronym == "NJ", "NJD", Accronym)) %>%
mutate(Accronym = ifelse(Accronym == "SJ", "SJS", Accronym)) %>%
mutate(Accronym = ifelse(Accronym =="TB", "TBL", Accronym))
Fenwick = mainpage %>%
html_nodes("td:nth-child(6)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Fenwick = .)
Fenwick_Last20 = last20page_main %>%
html_nodes("td:nth-child(10)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Fenwick_Last20 = .)
Corsi_Last20 = last20page_main %>%
html_nodes("td:nth-child(6)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Corsi_Last20 = .)
SOG_Last20 = last20page_main %>%
html_nodes("td:nth-child(14)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(SOG_Last20 = .)
rm(last20page_main)
GoalsPercentage_Last20 = last20page_Goals %>%
html_nodes("td:nth-child(4)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(GoalsPercentage_Last20 =.)
rm(last20page_Goals)
MissesPercentage_Last20 = last20page_misses %>%
html_nodes("td:nth-child(4)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(MissesPercentage_Last20 = .)
rm(last20page_misses)
BlocksPercentage_Last20 = last20page_blocks %>%
html_nodes("td:nth-child(4)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(BlocksPercentage_Last20 = .)
rm(last20page_blocks)
HitsPercentage_Last20 = last20page_hits %>%
html_nodes("td:nth-child(4)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(HitsPercentage_Last20 = .)
rm(last20page_hits)
data = left_join(teams,lookup_Accronyms, by = "Accronym") %>%
bind_cols(.,tibble(Year = rep(year, nrow(teams))),teams,Fenwick, Fenwick_Last20, Corsi_Last20, SOG_Last20, GoalsPercentage_Last20, MissesPercentage_Last20, BlocksPercentage_Last20, HitsPercentage_Last20) %>%
mutate(FullName = ifelse(FullName == "St. Louis Blues", "St Louis Blues", FullName)) %>%
mutate(FullName = ifelse(FullName == "Anaheim Ducks" & Year <= 2006, "Mighty Ducks of Anaheim", FullName))
View(data)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/Puck on Net.R', echo=TRUE)
