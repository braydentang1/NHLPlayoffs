library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
year = 3
year = 1997
numofSelections = 1
start = NA
end = NA
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
playerTables = vector("list", numofSelections)
year.format = paste(year-1, "-", str_sub(as.character(year), start = 3, end = 4), sep = "")
if(is.na(start) || is.na(end)){
start = 1
end = numofSelections
}
for (i in start:end){
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))$clickElement()
handles = rem_dr$getWindowHandles()
rem_dr$switchToWindow(handles[[2]])
page = read_html(rem_dr$getPageSource()[[1]])
position = page %>%
html_nodes(".v1-1") %>%
html_text(.) %>%
str_extract(., "[^ ]+") %>%
str_trim(., side = "both")
season = page %>%
html_nodes(".pds") %>%
html_text(.)
league = page %>%
html_nodes(".pdl") %>%
html_text(.)
if(str_detect(position, "Goalie") == TRUE || !any(season <= year.format)){
playerTables[[i]] = NA
rem_dr$switchToWindow(handles[[1]])
}else{
playerName = page %>%
html_nodes(".v1 .title") %>%
html_text(.)
height = page %>%
html_nodes(".v1-1") %>%
html_text(.) %>%
str_extract(., "Height.*") %>%
str_sub(., start = 8, end = 11) %>%
as.numeric(.)
weight = page %>%
html_nodes(".v1-1") %>%
html_text(.) %>%
str_extract(., "Weight.*") %>%
str_sub(., start = 8, end = 10) %>%
as.numeric(.)
checkforTournament = rem_dr$findElements(using = "css selector", value = "div.title")
if(length(checkforTournament) != 0){
gamesplayed = page %>%
html_nodes(".pdl+ td") %>%
html_text(.) %>%
as.numeric(.)
goals = page %>%
html_nodes(".st.reg tbody td:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.)
assists = page %>%
html_nodes(".st.reg tbody td:nth-child(6)") %>%
html_text(.) %>%
as.numeric(.)
penaltyminutes = page %>%
html_nodes(".st.reg tbody td:nth-child(8)") %>%
html_text(.) %>%
as.numeric(.)
plus.minus = page %>%
html_nodes(".st.reg tbody td:nth-child(9)") %>%
html_text(.) %>%
as.numeric(.)
}else{
gamesplayed = page %>%
html_nodes(".pdl+ td") %>%
html_text(.) %>%
as.numeric(.)
goals = page %>%
html_nodes("tbody td:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.)
assists = page %>%
html_nodes("tbody td:nth-child(6)") %>%
html_text(.) %>%
as.numeric(.)
penaltyminutes = page %>%
html_nodes("tbody td:nth-child(8)") %>%
html_text(.) %>%
as.numeric(.)
plus.minus = page %>%
html_nodes("tbody td:nth-child(9)") %>%
html_text(.) %>%
as.numeric(.)
}
PointsPerGame = (goals + assists)/gamesplayed
combined = tibble(Player = playerName, Season = season, League = league, Year = year, Games.Played = gamesplayed, GoalsPG = goals/gamesplayed, AssistsPG = assists/gamesplayed,
PIMPG = penaltyminutes/gamesplayed, PlusMinusPG = plus.minus/gamesplayed, Height = rep(height, length(PointsPerGame)), Weight = rep(weight, length(PointsPerGame)), PointsPerGame = PointsPerGame) %>%
filter(Season <= year.format)
playerTables[[i - start + 1]] = combined %>%
filter(League != "AHL") %>%
mutate_if(is.numeric, funs(ifelse(is.nan(.), NA, .))) %>%
mutate_if(is.numeric, funs(ifelse(is.infinite(.), NA,.)))
rem_dr$switchToWindow(handles[[1]])
}
}
playerTables.final = bind_rows(playerTables[!is.na(playerTables)]) %>%
mutate(na.count = rowSums(is.na(.))) %>%
filter(na.count <= 6) %>%
select(-na.count)
playerTables.final
rem_dr$screenshot(display = TRUE)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
year = 1997
numofSelections = 1
start = NA
end = NA
numofSelections = 25
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
rem_dr$screenshot(display = TRUE)
rem_dr$getTitle()
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
year = 2000
numofSelections = 2
start = NA
end = NA
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
rem_dr$getPageSource
playerTables = vector("list", numofSelections)
year.format = paste(year-1, "-", str_sub(as.character(year), start = 3, end = 4), sep = "")
if(is.na(start) || is.na(end)){
start = 1
end = numofSelections
}
i = 1
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))$clickElement()
handles = rem_dr$getWindowHandles()
rem_dr$switchToWindow(handles[[2]])
page = read_html(rem_dr$getPageSource()[[1]])
position = page %>%
html_nodes(".v1-1") %>%
html_text(.) %>%
str_extract(., "[^ ]+") %>%
str_trim(., side = "both")
season = page %>%
html_nodes(".pds") %>%
html_text(.)
league = page %>%
html_nodes(".pdl") %>%
html_text(.)
if(str_detect(position, "Goalie") == TRUE || !any(season <= year.format)){
playerTables[[i]] = NA
rem_dr$switchToWindow(handles[[1]])
}else{
playerName = page %>%
html_nodes(".v1 .title") %>%
html_text(.)
height = page %>%
html_nodes(".v1-1") %>%
html_text(.) %>%
str_extract(., "Height.*") %>%
str_sub(., start = 8, end = 11) %>%
as.numeric(.)
weight = page %>%
html_nodes(".v1-1") %>%
html_text(.) %>%
str_extract(., "Weight.*") %>%
str_sub(., start = 8, end = 10) %>%
as.numeric(.)
checkforTournament = rem_dr$findElements(using = "css selector", value = "div.title")
if(length(checkforTournament) != 0){
gamesplayed = page %>%
html_nodes(".pdl+ td") %>%
html_text(.) %>%
as.numeric(.)
goals = page %>%
html_nodes(".st.reg tbody td:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.)
assists = page %>%
html_nodes(".st.reg tbody td:nth-child(6)") %>%
html_text(.) %>%
as.numeric(.)
penaltyminutes = page %>%
html_nodes(".st.reg tbody td:nth-child(8)") %>%
html_text(.) %>%
as.numeric(.)
plus.minus = page %>%
html_nodes(".st.reg tbody td:nth-child(9)") %>%
html_text(.) %>%
as.numeric(.)
}else{
gamesplayed = page %>%
html_nodes(".pdl+ td") %>%
html_text(.) %>%
as.numeric(.)
goals = page %>%
html_nodes("tbody td:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.)
assists = page %>%
html_nodes("tbody td:nth-child(6)") %>%
html_text(.) %>%
as.numeric(.)
penaltyminutes = page %>%
html_nodes("tbody td:nth-child(8)") %>%
html_text(.) %>%
as.numeric(.)
plus.minus = page %>%
html_nodes("tbody td:nth-child(9)") %>%
html_text(.) %>%
as.numeric(.)
}
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))$clickElement()
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))$clickElement()
year = 2007
numofSelections = 25
start = 1
start = NA
end = NA
library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
playerTables = vector("list", numofSelections)
year.format = paste(year-1, "-", str_sub(as.character(year), start = 3, end = 4), sep = "")
if(is.na(start) || is.na(end)){
start = 1
end = numofSelections
}
i = 1
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))$clickElement()
rem_dr$screenshot(TRUE)
source('~/GitHub/NHLDraftProjections/Scraping/CentralScoutingRankings.R', echo=TRUE)
numofSelections = 20
start = end = NA
year = 1997
library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
playerTables = vector("list", numofSelections)
year.format = paste(year-1, "-", str_sub(as.character(year), start = 3, end = 4), sep = "")
if(is.na(start) || is.na(end)){
start = 1
end = numofSelections
}
i = 1
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))
source('~/GitHub/NHLDraftProjections/Scraping/Scrape NHL.R', echo=TRUE)
library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
source('~/GitHub/NHLDraftProjections/Scraping/Scrape NHL.R', echo=TRUE)
source('~/GitHub/NHLDraftProjections/Scraping/Scrape NHL.R', echo=TRUE)
year = 2007
numofSelections = 5
start = NA
end = NA
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
playerTables = vector("list", numofSelections)
year.format = paste(year-1, "-", str_sub(as.character(year), start = 3, end = 4), sep = "")
if(is.na(start) || is.na(end)){
start = 1
end = numofSelections
}
library(RSelenium)
library(rvest)
library(tidyverse)
rem_dr = remoteDriver(remoteServerAddr = "localhost", port = 4445L, browserName = "chrome")
rem_dr$open()
url = paste("http://www.hockeydb.com/ihdb/draft/nhl",year,"e.html", sep = "")
rem_dr$navigate(url)
playerTables = vector("list", numofSelections)
year.format = paste(year-1, "-", str_sub(as.character(year), start = 3, end = 4), sep = "")
if(is.na(start) || is.na(end)){
start = 1
end = numofSelections
}
i = 1
rem_dr$findElement(using = "css selector", value = paste("tr:nth-child(",i,") td:nth-child(4) a", sep = ""))$clickElement()
source('~/GitHub/NHLDraftProjections/Scraping/Scrape NHL.R', echo=TRUE)
source('~/GitHub/NHLDraftProjections/Scraping/Scrape NHL.R', echo=TRUE)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/OddsPortal.R', echo=TRUE)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/OddsPortal.R', echo=TRUE)
#Set the directory for parallel computation status checks. Change this to any folder on your computer so that we can monitor
#the status of the repeated cross validation.
setwd("/home/brayden/Desktop/status")
source('/home/brayden/GitHub/NHLPlayoffs/Modelling/Experiment All Functions.R')
#..................................Read data in....................................#
#Change directories to pull in data from the "Required Data Sets" folder located in the repository.
cat("Reading in Data..... \n")
allData = read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/HockeyReference2.csv") %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/HockeyReference1.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/CorsicaAllTeamStats.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/CorsicaGameScoreStats.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/ELORatings.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/ESPNStats.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/FenwickScores.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/NHLOfficialStats.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/SCFScores.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/VegasOddsOpening.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/EvolvingHockey_WAR.csv")) %>%
bind_cols(read_csv("/home/brayden/GitHub/NHLPlayoffs/Required Data Sets/TimeRelatedPlayoffFeatures.csv")) %>%
mutate(ResultProper = as.factor(ResultProper)) %>%
filter(!is.na(ResultProper))
View(allData)
str(allData)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/NHL Official.R', echo=TRUE)
View(allData)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/NHL Official.R', echo=TRUE)
View(allData)
year = 2019
rem_dr$navigate(paste("http://www.nhl.com/stats/team?report=realtime&reportType=season&seasonFrom=",year-1,year,"&seasonTo=",year - 1,year,"&gameType=2&filter=gamesPlayed,gte,1&sort=hits", sep = ""))
mainpage = read_html(rem_dr$getPageSource()[[1]])
TeamName = mainpage %>%
html_nodes(".rt-td:nth-child(2)") %>%
html_text(.) %>%
gsub("?", "e",.) %>%
gsub("\\.", "",.)
TeamName
TeamName = mainpage %>%
html_nodes(".rt-td:nth-child(2)") %>%
html_text(.)
TeamName
TeamName = mainpage %>%
html_nodes(".rt-td:nth-child(2)") %>%
html_text(.) %>%
gsub("?", "e",.)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/NHL Official.R', echo=TRUE)
View(allData)
View(allData)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/CorsicaAllTeamStats.R', echo=TRUE)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/CorsicaGameScore.R', echo=TRUE)
