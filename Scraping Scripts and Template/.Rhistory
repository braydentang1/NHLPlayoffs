library(tidyverse)
library(rvest)
library(RSelenium)
template = read.csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv", na.strings = FALSE, stringsAsFactors = FALSE)
accronyms_pg = read_html("https://en.wikipedia.org/wiki/Template:NHL_team_abbreviations")
accronyms = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 1,3)
fullnames = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 7, 1000000L)
lookup_Accronyms = cbind(FullName = fullnames, Accronym = accronyms) %>% as_tibble(.) %>% bind_rows(., c(FullName = "Mighty Ducks of Anaheim", Accronym = "MDA")) %>% bind_rows(., c(FullName = "St Louis Blues", Accronym = "STL"))
lookup_Accronyms$Accronym = ifelse(lookup_Accronyms$Accronym == "VGK", "VEG", lookup_Accronyms$Accronym)
rm(accronyms_pg, accronyms, fullnames)
#Create the rsDriver for Selenium
rd = rsDriver(browser = c("chrome"), chromever = "74.0.3729.6")
rem_dr = rd[["client"]]
rem_dr$navigate(paste("http://www.nhl.com/stats/team?report=realtime&reportType=season&seasonFrom=20182019&seasonTo=20182019&gameType=2&filter=gamesPlayed,gte,1&sort=hits"))
year = 2019
rem_dr$navigate(paste("http://www.nhl.com/stats/team?report=realtime&reportType=season&seasonFrom=",year-1,year,"&seasonTo=",year - 1,year,"&gameType=2&filter=gamesPlayed,gte,1&sort=hits", sep = ""))
mainpage = read_html(rem_dr$getPageSource[[1]])
mainpage = read_html(rem_dr$getPageSource()[[1]])
TeamName = mainpage %>%
html_nodes(".rt-td:nth-child(2)") %>%
html_text(.) %>%
gsub("Ã©", "e",.) %>%
gsub("\\.", "",.)
Hits = mainpage %>%
html_nodes(".rt-td:nth-child(10)") %>%
html_text(.) %>%
as.numeric(.)
Blocks = mainpage %>%
html_nodes(".rt-td:nth-child(11)") %>%
html_text(.) %>%
as.numeric(.)
FaceoffWinPercentage = mainpage %>%
html_nodes(".rt-td:nth-child(18)") %>%
html_text(.) %>%
as.numeric(.)
GiveAways = mainpage %>%
html_nodes(".rt-td:nth-child(13)") %>%
html_text(.) %>%
as.numeric(.)
TakeAways = mainpage %>%
html_nodes(".rt-td:nth-child(14)") %>%
html_text(.) %>%
as.numeric(.)
if(year == 2013){
Hits = Hits/48
Blocks = Blocks/48
GiveAways = GiveAways/48
TakeAways = TakeAways/48
}else{
Hits = Hits/82
Blocks = Blocks/82
GiveAways = GiveAways/82
TakeAways = TakeAways/82
}
data = tibble(Year = rep(year, length(TeamName)),Team = TeamName, BlocksatES = Blocks, HitsatES = Hits, FaceoffWinPercentage = FaceoffWinPercentage,
GiveAways = GiveAways, TakeAways = TakeAways) %>%
mutate(Team = ifelse(Team == "Anaheim Ducks" & year <= 2006, "Mighty Ducks of Anaheim", Team))
View(data)
library(tidyverse)
library(rvest)
library(RSelenium)
template = read_csv("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Scraping Scripts and Template/Template.csv")
accronyms_pg = read_html("https://en.wikipedia.org/wiki/Template:NHL_team_abbreviations")
accronyms = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 1,3)
fullnames = accronyms_pg %>%
html_nodes(".column-width li") %>%
html_text(.) %>%
substr(., 7, 1000000L)
lookup_Accronyms = cbind(FullName = fullnames, Accronym = accronyms) %>% as_tibble(.) %>% bind_rows(., c(FullName = "Mighty Ducks of Anaheim", Accronym = "MDA")) %>% bind_rows(., c(FullName = "St Louis Blues", Accronym = "STL"))
lookup_Accronyms$Accronym = ifelse(lookup_Accronyms$Accronym == "VGK", "VEG", lookup_Accronyms$Accronym)
rm(accronyms_pg, accronyms, fullnames)
#CAPS Sensitive!
#Input winner_FullTeamName/loser_FullTeamName as ex: "Ottawa Senators" or "St Louis Blues" (no period!)
#Input highest_seed as  ex: "Tampa Bay Lightning"
#Input conference as "western or eastern"
#Input round as "quarter-finals, "semi-finals", "finals", "or stanley-cup-final"
#Input year as 2006 (number)
rd = rsDriver(browser = c("chrome"), chromever = "74.0.3729.6")
rem_dr = rd[["client"]]
year = 2018
rem_dr$navigate(paste("https://www.hockey-reference.com/leagues/NHL_",year,".html"))
rem_dr$navigate(paste("https://www.hockey-reference.com/leagues/NHL_",year,".html", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
team_name = main %>%
html_nodes("#stats tbody .left") %>%
html_text(.) %>%
str_replace(.,"[*]", "") %>%
str_replace(., "[.]", "") %>%
tibble(Team = .)
average_age = main %>%
html_nodes("#stats tbody .left+ .right") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(AverageAge = .)
games_played = main %>%
html_nodes("#stats tbody .right:nth-child(4)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(GamesPlayed = .)
wins = main %>%
html_nodes("#stats tbody .right:nth-child(5)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Wins = .) %>%
transmute(RegularSeasonWinPercentage = Wins/games_played$GamesPlayed)
otl = main %>%
html_nodes("#stats tbody .right:nth-child(7)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(OTL = .) %>%
mutate(OTL = case_when(year == 2013 ~ OTL/48, year != 2013 ~ OTL/82))
Points = main %>%
html_nodes("#stats tbody .right:nth-child(8)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Points = .) %>%
mutate(Points = case_when(year == 2013 ~ Points/48, year != 2013 ~ Points/82))
PointsPercentage = main %>%
html_nodes("#stats tbody .right:nth-child(9)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(PointsPercentageofMax = .)
GoalsFor = main %>%
html_nodes("#stats tbody .right:nth-child(10)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(GoalsFor = .) %>%
mutate(GoalsFor = case_when(year == 2013 ~ GoalsFor/48, year != 2013 ~ GoalsFor/82))
GoalsAgainst = main %>%
html_nodes("#stats tbody .right:nth-child(11)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(GoalsAgainst = .) %>%
mutate(GoalsAgainst = case_when(year == 2013 ~ GoalsAgainst/48, year != 2013 ~ GoalsAgainst/82))
GoalDifferential = tibble(GoalDiff = GoalsFor$GoalsFor - GoalsAgainst$GoalsAgainst)
SRS = main %>%
html_nodes("#stats tbody .right:nth-child(14)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(SRS = .)
SOS = main %>%
html_nodes("#stats tbody .right:nth-child(15)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(SOS = .)
PenaltyinMinsPG = main %>%
html_nodes("tbody .right:nth-child(27)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(PenaltyMinsPG = .)
PowerPlayGoals = main %>%
html_nodes("#stats tbody .right:nth-child(19)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(PowerPlayGoals = .) %>%
mutate(PowerPlayGoals = case_when(year == 2013 ~ PowerPlayGoals/48, year != 2013 ~ PowerPlayGoals/82))
PowerPlayOppurtunities = main %>%
html_nodes("#stats tbody .right:nth-child(20)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(PowerPlayOppurtunities = .) %>%
mutate(PowerPlayOppurtunities = case_when(year == 2013 ~ PowerPlayOppurtunities/48, year != 2013 ~ PowerPlayOppurtunities/82))
PowerPlayPercentage = main %>%
html_nodes("#stats tbody .right:nth-child(21)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(PowerPlayPercentage =.)
PenaltyKillPercentage = main %>%
html_nodes("tbody .right:nth-child(24)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(PenaltyKillPercentage =.)
SOG = main %>%
html_nodes("tbody .right:nth-child(29)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(SOG =.) %>%
mutate(SOG = case_when(year == 2013 ~ SOG/48, year != 2013 ~ SOG/82))
ShotPercentage = main %>%
html_nodes("tbody .right:nth-child(30)") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(ShotPercentage =.)
bind_cols(tibble(Year = as.numeric(rep(year, nrow(team_name)))), team_name, average_age, wins, otl, Points, PointsPercentage, GoalsFor, GoalsAgainst, GoalDifferential, SRS, SOS, PenaltyinMinsPG, PowerPlayGoals,
PowerPlayOppurtunities, PowerPlayPercentage, PenaltyKillPercentage, SOG, ShotPercentage)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/OddsPortal.R', echo=TRUE)
library(tidyverse)
library(rvest)
library(RSelenium)
rd = rsDriver(browser = c("chrome"), chromever = "74.0.3729.6")
rem_dr = rd[["client"]]
year = 2018
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
View(teams2)
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[2]])
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
library(tidyverse)
library(rvest)
library(RSelenium)
rd = rsDriver(browser = c("chrome"), chromever = "74.0.3729.6")
rem_dr = rd[["client"]]
year = 2018
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant a") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
View(teams)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
main2 = read_html(rem_dr$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr$findElement(using = "css selector", value = ".active-page+ a span")$clickElement()
rd2 = rsDriver(port = 5000L, browser = c("chrome"), chromever = "74.0.3729.6")
rem_dr2 = rd[["client"]]
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
View(teams2)
View(teams)
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
View(teams2)
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
View(teams2)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
View(teams)
View(teams2)
View(teams2)
rem_dr2 = rd2[["client"]]
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams2)
View(teams)
rem_dr$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/", sep = ""))
main = read_html(rem_dr$getPageSource()[[1]])
rem_dr2$navigate(paste("https://www.oddsportal.com/hockey/usa/nhl-",year-1,"-",year,"/results/#/page/2/", sep = ""))
main2 = read_html(rem_dr2$getPageSource()[[1]])
teams = main %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
teams2 = main2 %>%
html_nodes(".table-participant") %>%
html_text(.) %>%
tibble(Teams = .)
View(teams)
View(teams2)
source('~/GitHub/NHLPlayoffs/Scraping Scripts and Template/OddsPortal.R', echo=TRUE)
year = 2019
round = "finals"
if(round == "quarter-finals"){
page = read_html(paste("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Odds HTML Renders/", year, " pg1.html", sep = ""))
}else if(round == "semi-finals"){
page = read_html(paste("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Odds HTML Renders/", year, " pg2.html", sep = ""))
}else if(round == "finals"){
page = read_html(paste("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Odds HTML Renders/", year, " pg3.html", sep = ""))
}else{
page = read_html(paste("C:/Users/Brayden/Documents/GitHub/NHLPlayoffs/Odds HTML Renders/", year, " pg4.html", sep = ""))
}
teams = page %>%
html_nodes(".table-participant a:nth-child(3)") %>%
html_text(.) %>%
tibble(Teams = .)
odds = page %>%
html_nodes(".table-participant+ .odds-nowrp a") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Odds.HighestSeed =.)
odds2 = page %>%
html_nodes(".odds-nowrp~ .odds-nowrp+ .odds-nowrp a") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Odds.LowestSeed =.)
combined = bind_cols(tibble(Year = rep(year, nrow(teams))), teams, odds, odds2)
View(odds)
View(odds2)
View(odds2)
teams = page %>%
html_nodes(".table-participant a:nth-child(3)") %>%
html_text(.) %>%
tibble(Teams = .)
odds = page %>%
html_nodes(".table-participant+ .odds-nowrp a") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Odds.HighestSeed =.)
odds2 = page %>%
html_nodes(".odds-nowrp~ .odds-nowrp+ .odds-nowrp:nth-child(5) a") %>%
html_text(.) %>%
as.numeric(.) %>%
tibble(Odds.LowestSeed =.)
combined = bind_cols(tibble(Year = rep(year, nrow(teams))), teams, odds, odds2)
View(combined)
View(combined)
